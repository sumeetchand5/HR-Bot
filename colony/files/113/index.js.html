<h1>index.js</h1>
<pre><code class="lang-js"><span class="keyword">var</span> minimist = require(<span class="string">'minimist'</span>);

module.exports = <span class="function"><span class="keyword">function</span> <span class="title">parse</span> <span class="params">(args, opts)</span> {</span>
    <span class="keyword">var</span> level = <span class="number">0</span>, index;
    <span class="keyword">var</span> args_ = [];
    
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; args.length; i++) {
        <span class="keyword">if</span> (<span class="keyword">typeof</span> args[i] === <span class="string">'string'</span> &amp;&amp; <span class="regexp">/^\[/</span>.test(args[i])) {
            <span class="keyword">if</span> (level ++ === <span class="number">0</span>) {
                index = i;
            }
        }
        <span class="keyword">if</span> (<span class="keyword">typeof</span> args[i] === <span class="string">'string'</span> &amp;&amp; <span class="regexp">/\]$/</span>.test(args[i])) {
            <span class="keyword">if</span> (-- level > <span class="number">0</span>) <span class="keyword">continue</span>;
            
            <span class="keyword">var</span> sub = args.slice(index, i + <span class="number">1</span>);
            <span class="keyword">if</span> (<span class="keyword">typeof</span> sub[<span class="number">0</span>] === <span class="string">'string'</span>) {
                sub[<span class="number">0</span>] = sub[<span class="number">0</span>].replace(<span class="regexp">/^\[/</span>, <span class="string">''</span>);
            }
            <span class="keyword">if</span> (sub[<span class="number">0</span>] === <span class="string">''</span>) sub.shift();
            
            <span class="keyword">var</span> n = sub.length - <span class="number">1</span>;
            <span class="keyword">if</span> (<span class="keyword">typeof</span> sub[n] === <span class="string">'string'</span>) {
                sub[n] = sub[n].replace(<span class="regexp">/\]$/</span>, <span class="string">''</span>);
            }
            <span class="keyword">if</span> (sub[n] === <span class="string">''</span>) sub.pop();
            
            args_.push(parse(sub));
        }
        <span class="keyword">else</span> <span class="keyword">if</span> (level === <span class="number">0</span>) args_.push(args[i]);
    }
    
    <span class="keyword">var</span> argv = minimist(args_, opts);
    <span class="keyword">return</span> argv;
};
</code></pre>