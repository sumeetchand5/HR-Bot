<h1>index.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">if</span> (<span class="keyword">typeof</span> process === <span class="string">'undefined'</span> ||
    !process.version ||
    process.version.indexOf(<span class="string">'v0.'</span>) === <span class="number">0</span> ||
    process.version.indexOf(<span class="string">'v1.'</span>) === <span class="number">0</span> &amp;&amp; process.version.indexOf(<span class="string">'v1.8.'</span>) !== <span class="number">0</span>) {
  module.exports = { nextTick: nextTick };
} <span class="keyword">else</span> {
  module.exports = process
}

<span class="function"><span class="keyword">function</span> <span class="title">nextTick</span><span class="params">(fn, arg1, arg2, arg3)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">'function'</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(<span class="string">'"callback" argument must be a function'</span>);
  }
  <span class="keyword">var</span> len = arguments.length;
  <span class="keyword">var</span> args, i;
  <span class="keyword">switch</span> (len) {
  <span class="keyword">case</span> <span class="number">0</span>:
  <span class="keyword">case</span> <span class="number">1</span>:
    <span class="keyword">return</span> process.nextTick(fn);
  <span class="keyword">case</span> <span class="number">2</span>:
    <span class="keyword">return</span> process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">afterTickOne</span><span class="params">()</span> {</span>
      fn.call(<span class="literal">null</span>, arg1);
    });
  <span class="keyword">case</span> <span class="number">3</span>:
    <span class="keyword">return</span> process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">afterTickTwo</span><span class="params">()</span> {</span>
      fn.call(<span class="literal">null</span>, arg1, arg2);
    });
  <span class="keyword">case</span> <span class="number">4</span>:
    <span class="keyword">return</span> process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">afterTickThree</span><span class="params">()</span> {</span>
      fn.call(<span class="literal">null</span>, arg1, arg2, arg3);
    });
  <span class="keyword">default</span>:
    args = <span class="keyword">new</span> Array(len - <span class="number">1</span>);
    i = <span class="number">0</span>;
    <span class="keyword">while</span> (i &lt; args.length) {
      args[i++] = arguments[i];
    }
    <span class="keyword">return</span> process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">afterTick</span><span class="params">()</span> {</span>
      fn.apply(<span class="literal">null</span>, args);
    });
  }
}

</code></pre>