<h1>encode.js</h1>
<pre><code class="lang-js"><span class="comment">// Copyright Joyent, Inc. and other Node contributors.</span>
<span class="comment">//</span>
<span class="comment">// Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="comment">// copy of this software and associated documentation files (the</span>
<span class="comment">// "Software"), to deal in the Software without restriction, including</span>
<span class="comment">// without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="comment">// distribute, sublicense, and/or sell copies of the Software, and to permit</span>
<span class="comment">// persons to whom the Software is furnished to do so, subject to the</span>
<span class="comment">// following conditions:</span>
<span class="comment">//</span>
<span class="comment">// The above copyright notice and this permission notice shall be included</span>
<span class="comment">// in all copies or substantial portions of the Software.</span>
<span class="comment">//</span>
<span class="comment">// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<span class="comment">// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="comment">// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN</span>
<span class="comment">// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,</span>
<span class="comment">// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR</span>
<span class="comment">// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE</span>
<span class="comment">// USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="string">'use strict'</span>;

<span class="keyword">var</span> stringifyPrimitive = <span class="keyword">function</span>(v) {
  <span class="keyword">switch</span> (<span class="keyword">typeof</span> v) {
    <span class="keyword">case</span> <span class="string">'string'</span>:
      <span class="keyword">return</span> v;

    <span class="keyword">case</span> <span class="string">'boolean'</span>:
      <span class="keyword">return</span> v ? <span class="string">'true'</span> : <span class="string">'false'</span>;

    <span class="keyword">case</span> <span class="string">'number'</span>:
      <span class="keyword">return</span> isFinite(v) ? v : <span class="string">''</span>;

    <span class="keyword">default</span>:
      <span class="keyword">return</span> <span class="string">''</span>;
  }
};

module.exports = <span class="keyword">function</span>(obj, sep, eq, name) {
  sep = sep || <span class="string">'&amp;'</span>;
  eq = eq || <span class="string">'='</span>;
  <span class="keyword">if</span> (obj === <span class="literal">null</span>) {
    obj = <span class="literal">undefined</span>;
  }

  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">'object'</span>) {
    <span class="keyword">return</span> map(objectKeys(obj), <span class="keyword">function</span>(k) {
      <span class="keyword">var</span> ks = encodeURIComponent(stringifyPrimitive(k)) + eq;
      <span class="keyword">if</span> (isArray(obj[k])) {
        <span class="keyword">return</span> map(obj[k], <span class="keyword">function</span>(v) {
          <span class="keyword">return</span> ks + encodeURIComponent(stringifyPrimitive(v));
        }).join(sep);
      } <span class="keyword">else</span> {
        <span class="keyword">return</span> ks + encodeURIComponent(stringifyPrimitive(obj[k]));
      }
    }).join(sep);

  }

  <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="string">''</span>;
  <span class="keyword">return</span> encodeURIComponent(stringifyPrimitive(name)) + eq +
         encodeURIComponent(stringifyPrimitive(obj));
};

<span class="keyword">var</span> isArray = Array.isArray || <span class="function"><span class="keyword">function</span> <span class="params">(xs)</span> {</span>
  <span class="keyword">return</span> Object.prototype.toString.call(xs) === <span class="string">'[object Array]'</span>;
};

<span class="function"><span class="keyword">function</span> <span class="title">map</span> <span class="params">(xs, f)</span> {</span>
  <span class="keyword">if</span> (xs.map) <span class="keyword">return</span> xs.map(f);
  <span class="keyword">var</span> res = [];
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; xs.length; i++) {
    res.push(f(xs[i], i));
  }
  <span class="keyword">return</span> res;
}

<span class="keyword">var</span> objectKeys = Object.keys || <span class="function"><span class="keyword">function</span> <span class="params">(obj)</span> {</span>
  <span class="keyword">var</span> res = [];
  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> obj) {
    <span class="keyword">if</span> (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);
  }
  <span class="keyword">return</span> res;
};
</code></pre>