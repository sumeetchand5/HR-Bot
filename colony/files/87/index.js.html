<h1>index.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">var</span> isWindows = process.platform === <span class="string">'win32'</span>;

<span class="comment">// Regex to split a windows path into three parts: [*, device, slash,</span>
<span class="comment">// tail] windows-only</span>
<span class="keyword">var</span> splitDeviceRe =
    <span class="regexp">/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/</span>;

<span class="comment">// Regex to split the tail part of the above into [*, dir, basename, ext]</span>
<span class="keyword">var</span> splitTailRe =
    <span class="regexp">/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/</span>;

<span class="keyword">var</span> win32 = {};

<span class="comment">// Function to split a filename into [root, dir, basename, ext]</span>
<span class="function"><span class="keyword">function</span> <span class="title">win32SplitPath</span><span class="params">(filename)</span> {</span>
  <span class="comment">// Separate device+slash from tail</span>
  <span class="keyword">var</span> result = splitDeviceRe.exec(filename),
      device = (result[<span class="number">1</span>] || <span class="string">''</span>) + (result[<span class="number">2</span>] || <span class="string">''</span>),
      tail = result[<span class="number">3</span>] || <span class="string">''</span>;
  <span class="comment">// Split the tail into dir, basename and extension</span>
  <span class="keyword">var</span> result2 = splitTailRe.exec(tail),
      dir = result2[<span class="number">1</span>],
      basename = result2[<span class="number">2</span>],
      ext = result2[<span class="number">3</span>];
  <span class="keyword">return</span> [device, dir, basename, ext];
}

win32.parse = <span class="keyword">function</span>(pathString) {
  <span class="keyword">if</span> (<span class="keyword">typeof</span> pathString !== <span class="string">'string'</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(
        <span class="string">"Parameter 'pathString' must be a string, not "</span> + <span class="keyword">typeof</span> pathString
    );
  }
  <span class="keyword">var</span> allParts = win32SplitPath(pathString);
  <span class="keyword">if</span> (!allParts || allParts.length !== <span class="number">4</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(<span class="string">"Invalid path '"</span> + pathString + <span class="string">"'"</span>);
  }
  <span class="keyword">return</span> {
    root: allParts[<span class="number">0</span>],
    dir: allParts[<span class="number">0</span>] + allParts[<span class="number">1</span>].slice(<span class="number">0</span>, -<span class="number">1</span>),
    base: allParts[<span class="number">2</span>],
    ext: allParts[<span class="number">3</span>],
    name: allParts[<span class="number">2</span>].slice(<span class="number">0</span>, allParts[<span class="number">2</span>].length - allParts[<span class="number">3</span>].length)
  };
};



<span class="comment">// Split a filename into [root, dir, basename, ext], unix version</span>
<span class="comment">// 'root' is just a slash, or nothing.</span>
<span class="keyword">var</span> splitPathRe =
    <span class="regexp">/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/</span>;
<span class="keyword">var</span> posix = {};


<span class="function"><span class="keyword">function</span> <span class="title">posixSplitPath</span><span class="params">(filename)</span> {</span>
  <span class="keyword">return</span> splitPathRe.exec(filename).slice(<span class="number">1</span>);
}


posix.parse = <span class="keyword">function</span>(pathString) {
  <span class="keyword">if</span> (<span class="keyword">typeof</span> pathString !== <span class="string">'string'</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(
        <span class="string">"Parameter 'pathString' must be a string, not "</span> + <span class="keyword">typeof</span> pathString
    );
  }
  <span class="keyword">var</span> allParts = posixSplitPath(pathString);
  <span class="keyword">if</span> (!allParts || allParts.length !== <span class="number">4</span>) {
    <span class="keyword">throw</span> <span class="keyword">new</span> TypeError(<span class="string">"Invalid path '"</span> + pathString + <span class="string">"'"</span>);
  }
  allParts[<span class="number">1</span>] = allParts[<span class="number">1</span>] || <span class="string">''</span>;
  allParts[<span class="number">2</span>] = allParts[<span class="number">2</span>] || <span class="string">''</span>;
  allParts[<span class="number">3</span>] = allParts[<span class="number">3</span>] || <span class="string">''</span>;

  <span class="keyword">return</span> {
    root: allParts[<span class="number">0</span>],
    dir: allParts[<span class="number">0</span>] + allParts[<span class="number">1</span>].slice(<span class="number">0</span>, -<span class="number">1</span>),
    base: allParts[<span class="number">2</span>],
    ext: allParts[<span class="number">3</span>],
    name: allParts[<span class="number">2</span>].slice(<span class="number">0</span>, allParts[<span class="number">2</span>].length - allParts[<span class="number">3</span>].length)
  };
};


<span class="keyword">if</span> (isWindows)
  module.exports = win32.parse;
<span class="keyword">else</span> <span class="comment">/* posix */</span>
  module.exports = posix.parse;

module.exports.posix = posix.parse;
module.exports.win32 = win32.parse;
</code></pre>