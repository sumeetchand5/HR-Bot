<h1>ede.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">var</span> assert = require(<span class="string">'minimalistic-assert'</span>);
<span class="keyword">var</span> inherits = require(<span class="string">'inherits'</span>);

<span class="keyword">var</span> des = require(<span class="string">'../des'</span>);
<span class="keyword">var</span> Cipher = des.Cipher;
<span class="keyword">var</span> DES = des.DES;

<span class="function"><span class="keyword">function</span> <span class="title">EDEState</span><span class="params">(type, key)</span> {</span>
  assert.equal(key.length, <span class="number">24</span>, <span class="string">'Invalid key length'</span>);

  <span class="keyword">var</span> k1 = key.slice(<span class="number">0</span>, <span class="number">8</span>);
  <span class="keyword">var</span> k2 = key.slice(<span class="number">8</span>, <span class="number">16</span>);
  <span class="keyword">var</span> k3 = key.slice(<span class="number">16</span>, <span class="number">24</span>);

  <span class="keyword">if</span> (type === <span class="string">'encrypt'</span>) {
    <span class="keyword">this</span>.ciphers = [
      DES.create({ type: <span class="string">'encrypt'</span>, key: k1 }),
      DES.create({ type: <span class="string">'decrypt'</span>, key: k2 }),
      DES.create({ type: <span class="string">'encrypt'</span>, key: k3 })
    ];
  } <span class="keyword">else</span> {
    <span class="keyword">this</span>.ciphers = [
      DES.create({ type: <span class="string">'decrypt'</span>, key: k3 }),
      DES.create({ type: <span class="string">'encrypt'</span>, key: k2 }),
      DES.create({ type: <span class="string">'decrypt'</span>, key: k1 })
    ];
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">EDE</span><span class="params">(options)</span> {</span>
  Cipher.call(<span class="keyword">this</span>, options);

  <span class="keyword">var</span> state = <span class="keyword">new</span> EDEState(<span class="keyword">this</span>.type, <span class="keyword">this</span>.options.key);
  <span class="keyword">this</span>._edeState = state;
}
inherits(EDE, Cipher);

module.exports = EDE;

EDE.create = <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(options)</span> {</span>
  <span class="keyword">return</span> <span class="keyword">new</span> EDE(options);
};

EDE.prototype._update = <span class="function"><span class="keyword">function</span> <span class="title">_update</span><span class="params">(inp, inOff, out, outOff)</span> {</span>
  <span class="keyword">var</span> state = <span class="keyword">this</span>._edeState;

  state.ciphers[<span class="number">0</span>]._update(inp, inOff, out, outOff);
  state.ciphers[<span class="number">1</span>]._update(out, outOff, out, outOff);
  state.ciphers[<span class="number">2</span>]._update(out, outOff, out, outOff);
};

EDE.prototype._pad = DES.prototype._pad;
EDE.prototype._unpad = DES.prototype._unpad;
</code></pre>