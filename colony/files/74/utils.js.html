<h1>utils.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">var</span> utils = exports;

<span class="function"><span class="keyword">function</span> <span class="title">toArray</span><span class="params">(msg, enc)</span> {</span>
  <span class="keyword">if</span> (Array.isArray(msg))
    <span class="keyword">return</span> msg.slice();
  <span class="keyword">if</span> (!msg)
    <span class="keyword">return</span> [];
  <span class="keyword">var</span> res = [];
  <span class="keyword">if</span> (<span class="keyword">typeof</span> msg !== <span class="string">'string'</span>) {
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; msg.length; i++)
      res[i] = msg[i] | <span class="number">0</span>;
    <span class="keyword">return</span> res;
  }
  <span class="keyword">if</span> (enc === <span class="string">'hex'</span>) {
    msg = msg.replace(<span class="regexp">/[^a-z0-9]+/ig</span>, <span class="string">''</span>);
    <span class="keyword">if</span> (msg.length % <span class="number">2</span> !== <span class="number">0</span>)
      msg = <span class="string">'0'</span> + msg;
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; msg.length; i += <span class="number">2</span>)
      res.push(parseInt(msg[i] + msg[i + <span class="number">1</span>], <span class="number">16</span>));
  } <span class="keyword">else</span> {
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; msg.length; i++) {
      <span class="keyword">var</span> c = msg.charCodeAt(i);
      <span class="keyword">var</span> hi = c >> <span class="number">8</span>;
      <span class="keyword">var</span> lo = c &amp; <span class="number">0xff</span>;
      <span class="keyword">if</span> (hi)
        res.push(hi, lo);
      <span class="keyword">else</span>
        res.push(lo);
    }
  }
  <span class="keyword">return</span> res;
}
utils.toArray = toArray;

<span class="function"><span class="keyword">function</span> <span class="title">zero2</span><span class="params">(word)</span> {</span>
  <span class="keyword">if</span> (word.length === <span class="number">1</span>)
    <span class="keyword">return</span> <span class="string">'0'</span> + word;
  <span class="keyword">else</span>
    <span class="keyword">return</span> word;
}
utils.zero2 = zero2;

<span class="function"><span class="keyword">function</span> <span class="title">toHex</span><span class="params">(msg)</span> {</span>
  <span class="keyword">var</span> res = <span class="string">''</span>;
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; msg.length; i++)
    res += zero2(msg[i].toString(<span class="number">16</span>));
  <span class="keyword">return</span> res;
}
utils.toHex = toHex;

utils.encode = <span class="function"><span class="keyword">function</span> <span class="title">encode</span><span class="params">(arr, enc)</span> {</span>
  <span class="keyword">if</span> (enc === <span class="string">'hex'</span>)
    <span class="keyword">return</span> toHex(arr);
  <span class="keyword">else</span>
    <span class="keyword">return</span> arr;
};
</code></pre>