<h1>index.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;


<span class="keyword">var</span> templateSTR = <span class="string">"(function(f){if(typeof exports===\"object\"&amp;&amp;typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&amp;&amp;define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}defineNamespace()}})(function(){source()});\n"</span>;

<span class="function"><span class="keyword">function</span> <span class="title">template</span><span class="params">(moduleName, options)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">'boolean'</span>) {
    options = {commonJS: options};
  } <span class="keyword">else</span> <span class="keyword">if</span> (!options) {
    options = {};
  }
  <span class="keyword">var</span> str = templateSTR.replace(<span class="regexp">/defineNamespace\(\)/g</span>, compileNamespace(moduleName))
    .split(<span class="string">'source()'</span>)
  str[<span class="number">0</span>] = str[<span class="number">0</span>].trim();
  <span class="comment">//make sure these are undefined so as to not get confused if modules have inner UMD systems</span>
  str[<span class="number">0</span>] += <span class="string">'var define,module,exports;'</span>;
  <span class="keyword">if</span> (options.commonJS) str[<span class="number">0</span>] += <span class="string">'module={exports:(exports={})};'</span>;
  str[<span class="number">0</span>] += <span class="string">'\n'</span>;
  <span class="keyword">if</span> (options.commonJS) str[<span class="number">1</span>] = <span class="string">'return module.exports;'</span> + str[<span class="number">1</span>];
  str[<span class="number">1</span>] = <span class="string">'\n'</span> + str[<span class="number">1</span>];
  <span class="keyword">return</span> str;
}

exports = module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(name, src, options)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">'string'</span> &amp;&amp; <span class="keyword">typeof</span> src === <span class="string">'object'</span>) {
    <span class="keyword">var</span> tmp = options;
    options = src;
    src = tmp;
  }
  <span class="keyword">return</span> exports.prelude(name, options) + src + exports.postlude(name, options);
};

exports.prelude = <span class="function"><span class="keyword">function</span> <span class="params">(moduleName, options)</span> {</span>
  <span class="keyword">return</span> template(moduleName, options)[<span class="number">0</span>];
};
exports.postlude = <span class="function"><span class="keyword">function</span> <span class="params">(moduleName, options)</span> {</span>
  <span class="keyword">return</span> template(moduleName, options)[<span class="number">1</span>];
};


<span class="function"><span class="keyword">function</span> <span class="title">camelCase</span><span class="params">(name)</span> {</span>
  name = name.replace(<span class="regexp">/\-([a-z])/g</span>, <span class="function"><span class="keyword">function</span> <span class="params">(_, char)</span> {</span> <span class="keyword">return</span> char.toUpperCase(); });
  <span class="keyword">if</span> (!<span class="regexp">/^[a-zA-Z_$]$/</span>.test(name[<span class="number">0</span>])) {
    name = name.substr(<span class="number">1</span>);
  }
  <span class="keyword">var</span> result = name.replace(<span class="regexp">/[^\w$]+/g</span>, <span class="string">''</span>)
  <span class="keyword">if</span> (!result) {
    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Invalid JavaScript identifier resulted from camel-casing'</span>);
  }
  <span class="keyword">return</span> result
}


<span class="function"><span class="keyword">function</span> <span class="title">compileNamespace</span><span class="params">(name)</span> {</span>
  <span class="keyword">var</span> names = name.split(<span class="string">'.'</span>)

  <span class="comment">// No namespaces, yield the best case 'global.NAME = VALUE'</span>
  <span class="keyword">if</span> (names.length === <span class="number">1</span>) {
    <span class="keyword">return</span> <span class="string">'g.'</span> + camelCase(name) + <span class="string">' = f()'</span>;

  <span class="comment">// Acceptable case, with reasonable compilation</span>
  } <span class="keyword">else</span> <span class="keyword">if</span> (names.length === <span class="number">2</span>) {
    names = names.map(camelCase);
    <span class="keyword">return</span> <span class="string">'(g.'</span> + names[<span class="number">0</span>] + <span class="string">' || (g.'</span> + names[<span class="number">0</span>] + <span class="string">' = {})).'</span> + names[<span class="number">1</span>] + <span class="string">' = f()'</span>;

  <span class="comment">// Worst case, too many namespaces to care about</span>
  } <span class="keyword">else</span> {
    <span class="keyword">var</span> valueContainer = names.pop()
    <span class="keyword">return</span> names.map(compileNamespaceStep)
                .concat([<span class="string">'g.'</span> + camelCase(valueContainer) + <span class="string">' = f()'</span>])
                .join(<span class="string">';'</span>);
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">compileNamespaceStep</span><span class="params">(name)</span> {</span>
  name = camelCase(name);
  <span class="keyword">return</span> <span class="string">'g=(g.'</span> + name + <span class="string">'||(g.'</span> + name + <span class="string">' = {}))'</span>;
}
</code></pre>