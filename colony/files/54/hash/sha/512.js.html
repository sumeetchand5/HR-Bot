<h1>512.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">var</span> utils = require(<span class="string">'../utils'</span>);
<span class="keyword">var</span> common = require(<span class="string">'../common'</span>);
<span class="keyword">var</span> assert = require(<span class="string">'minimalistic-assert'</span>);

<span class="keyword">var</span> rotr64_hi = utils.rotr64_hi;
<span class="keyword">var</span> rotr64_lo = utils.rotr64_lo;
<span class="keyword">var</span> shr64_hi = utils.shr64_hi;
<span class="keyword">var</span> shr64_lo = utils.shr64_lo;
<span class="keyword">var</span> sum64 = utils.sum64;
<span class="keyword">var</span> sum64_hi = utils.sum64_hi;
<span class="keyword">var</span> sum64_lo = utils.sum64_lo;
<span class="keyword">var</span> sum64_4_hi = utils.sum64_4_hi;
<span class="keyword">var</span> sum64_4_lo = utils.sum64_4_lo;
<span class="keyword">var</span> sum64_5_hi = utils.sum64_5_hi;
<span class="keyword">var</span> sum64_5_lo = utils.sum64_5_lo;

<span class="keyword">var</span> BlockHash = common.BlockHash;

<span class="keyword">var</span> sha512_K = [
  <span class="number">0x428a2f98</span>, <span class="number">0xd728ae22</span>, <span class="number">0x71374491</span>, <span class="number">0x23ef65cd</span>,
  <span class="number">0xb5c0fbcf</span>, <span class="number">0xec4d3b2f</span>, <span class="number">0xe9b5dba5</span>, <span class="number">0x8189dbbc</span>,
  <span class="number">0x3956c25b</span>, <span class="number">0xf348b538</span>, <span class="number">0x59f111f1</span>, <span class="number">0xb605d019</span>,
  <span class="number">0x923f82a4</span>, <span class="number">0xaf194f9b</span>, <span class="number">0xab1c5ed5</span>, <span class="number">0xda6d8118</span>,
  <span class="number">0xd807aa98</span>, <span class="number">0xa3030242</span>, <span class="number">0x12835b01</span>, <span class="number">0x45706fbe</span>,
  <span class="number">0x243185be</span>, <span class="number">0x4ee4b28c</span>, <span class="number">0x550c7dc3</span>, <span class="number">0xd5ffb4e2</span>,
  <span class="number">0x72be5d74</span>, <span class="number">0xf27b896f</span>, <span class="number">0x80deb1fe</span>, <span class="number">0x3b1696b1</span>,
  <span class="number">0x9bdc06a7</span>, <span class="number">0x25c71235</span>, <span class="number">0xc19bf174</span>, <span class="number">0xcf692694</span>,
  <span class="number">0xe49b69c1</span>, <span class="number">0x9ef14ad2</span>, <span class="number">0xefbe4786</span>, <span class="number">0x384f25e3</span>,
  <span class="number">0x0fc19dc6</span>, <span class="number">0x8b8cd5b5</span>, <span class="number">0x240ca1cc</span>, <span class="number">0x77ac9c65</span>,
  <span class="number">0x2de92c6f</span>, <span class="number">0x592b0275</span>, <span class="number">0x4a7484aa</span>, <span class="number">0x6ea6e483</span>,
  <span class="number">0x5cb0a9dc</span>, <span class="number">0xbd41fbd4</span>, <span class="number">0x76f988da</span>, <span class="number">0x831153b5</span>,
  <span class="number">0x983e5152</span>, <span class="number">0xee66dfab</span>, <span class="number">0xa831c66d</span>, <span class="number">0x2db43210</span>,
  <span class="number">0xb00327c8</span>, <span class="number">0x98fb213f</span>, <span class="number">0xbf597fc7</span>, <span class="number">0xbeef0ee4</span>,
  <span class="number">0xc6e00bf3</span>, <span class="number">0x3da88fc2</span>, <span class="number">0xd5a79147</span>, <span class="number">0x930aa725</span>,
  <span class="number">0x06ca6351</span>, <span class="number">0xe003826f</span>, <span class="number">0x14292967</span>, <span class="number">0x0a0e6e70</span>,
  <span class="number">0x27b70a85</span>, <span class="number">0x46d22ffc</span>, <span class="number">0x2e1b2138</span>, <span class="number">0x5c26c926</span>,
  <span class="number">0x4d2c6dfc</span>, <span class="number">0x5ac42aed</span>, <span class="number">0x53380d13</span>, <span class="number">0x9d95b3df</span>,
  <span class="number">0x650a7354</span>, <span class="number">0x8baf63de</span>, <span class="number">0x766a0abb</span>, <span class="number">0x3c77b2a8</span>,
  <span class="number">0x81c2c92e</span>, <span class="number">0x47edaee6</span>, <span class="number">0x92722c85</span>, <span class="number">0x1482353b</span>,
  <span class="number">0xa2bfe8a1</span>, <span class="number">0x4cf10364</span>, <span class="number">0xa81a664b</span>, <span class="number">0xbc423001</span>,
  <span class="number">0xc24b8b70</span>, <span class="number">0xd0f89791</span>, <span class="number">0xc76c51a3</span>, <span class="number">0x0654be30</span>,
  <span class="number">0xd192e819</span>, <span class="number">0xd6ef5218</span>, <span class="number">0xd6990624</span>, <span class="number">0x5565a910</span>,
  <span class="number">0xf40e3585</span>, <span class="number">0x5771202a</span>, <span class="number">0x106aa070</span>, <span class="number">0x32bbd1b8</span>,
  <span class="number">0x19a4c116</span>, <span class="number">0xb8d2d0c8</span>, <span class="number">0x1e376c08</span>, <span class="number">0x5141ab53</span>,
  <span class="number">0x2748774c</span>, <span class="number">0xdf8eeb99</span>, <span class="number">0x34b0bcb5</span>, <span class="number">0xe19b48a8</span>,
  <span class="number">0x391c0cb3</span>, <span class="number">0xc5c95a63</span>, <span class="number">0x4ed8aa4a</span>, <span class="number">0xe3418acb</span>,
  <span class="number">0x5b9cca4f</span>, <span class="number">0x7763e373</span>, <span class="number">0x682e6ff3</span>, <span class="number">0xd6b2b8a3</span>,
  <span class="number">0x748f82ee</span>, <span class="number">0x5defb2fc</span>, <span class="number">0x78a5636f</span>, <span class="number">0x43172f60</span>,
  <span class="number">0x84c87814</span>, <span class="number">0xa1f0ab72</span>, <span class="number">0x8cc70208</span>, <span class="number">0x1a6439ec</span>,
  <span class="number">0x90befffa</span>, <span class="number">0x23631e28</span>, <span class="number">0xa4506ceb</span>, <span class="number">0xde82bde9</span>,
  <span class="number">0xbef9a3f7</span>, <span class="number">0xb2c67915</span>, <span class="number">0xc67178f2</span>, <span class="number">0xe372532b</span>,
  <span class="number">0xca273ece</span>, <span class="number">0xea26619c</span>, <span class="number">0xd186b8c7</span>, <span class="number">0x21c0c207</span>,
  <span class="number">0xeada7dd6</span>, <span class="number">0xcde0eb1e</span>, <span class="number">0xf57d4f7f</span>, <span class="number">0xee6ed178</span>,
  <span class="number">0x06f067aa</span>, <span class="number">0x72176fba</span>, <span class="number">0x0a637dc5</span>, <span class="number">0xa2c898a6</span>,
  <span class="number">0x113f9804</span>, <span class="number">0xbef90dae</span>, <span class="number">0x1b710b35</span>, <span class="number">0x131c471b</span>,
  <span class="number">0x28db77f5</span>, <span class="number">0x23047d84</span>, <span class="number">0x32caab7b</span>, <span class="number">0x40c72493</span>,
  <span class="number">0x3c9ebe0a</span>, <span class="number">0x15c9bebc</span>, <span class="number">0x431d67c4</span>, <span class="number">0x9c100d4c</span>,
  <span class="number">0x4cc5d4be</span>, <span class="number">0xcb3e42b6</span>, <span class="number">0x597f299c</span>, <span class="number">0xfc657e2a</span>,
  <span class="number">0x5fcb6fab</span>, <span class="number">0x3ad6faec</span>, <span class="number">0x6c44198c</span>, <span class="number">0x4a475817</span>
];

<span class="function"><span class="keyword">function</span> <span class="title">SHA512</span><span class="params">()</span> {</span>
  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SHA512))
    <span class="keyword">return</span> <span class="keyword">new</span> SHA512();

  BlockHash.call(<span class="keyword">this</span>);
  <span class="keyword">this</span>.h = [
    <span class="number">0x6a09e667</span>, <span class="number">0xf3bcc908</span>,
    <span class="number">0xbb67ae85</span>, <span class="number">0x84caa73b</span>,
    <span class="number">0x3c6ef372</span>, <span class="number">0xfe94f82b</span>,
    <span class="number">0xa54ff53a</span>, <span class="number">0x5f1d36f1</span>,
    <span class="number">0x510e527f</span>, <span class="number">0xade682d1</span>,
    <span class="number">0x9b05688c</span>, <span class="number">0x2b3e6c1f</span>,
    <span class="number">0x1f83d9ab</span>, <span class="number">0xfb41bd6b</span>,
    <span class="number">0x5be0cd19</span>, <span class="number">0x137e2179</span> ];
  <span class="keyword">this</span>.k = sha512_K;
  <span class="keyword">this</span>.W = <span class="keyword">new</span> Array(<span class="number">160</span>);
}
utils.inherits(SHA512, BlockHash);
module.exports = SHA512;

SHA512.blockSize = <span class="number">1024</span>;
SHA512.outSize = <span class="number">512</span>;
SHA512.hmacStrength = <span class="number">192</span>;
SHA512.padLength = <span class="number">128</span>;

SHA512.prototype._prepareBlock = <span class="function"><span class="keyword">function</span> <span class="title">_prepareBlock</span><span class="params">(msg, start)</span> {</span>
  <span class="keyword">var</span> W = <span class="keyword">this</span>.W;

  <span class="comment">// 32 x 32bit words</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)
    W[i] = msg[start + i];
  <span class="keyword">for</span> (; i &lt; W.length; i += <span class="number">2</span>) {
    <span class="keyword">var</span> c0_hi = g1_512_hi(W[i - <span class="number">4</span>], W[i - <span class="number">3</span>]);  <span class="comment">// i - 2</span>
    <span class="keyword">var</span> c0_lo = g1_512_lo(W[i - <span class="number">4</span>], W[i - <span class="number">3</span>]);
    <span class="keyword">var</span> c1_hi = W[i - <span class="number">14</span>];  <span class="comment">// i - 7</span>
    <span class="keyword">var</span> c1_lo = W[i - <span class="number">13</span>];
    <span class="keyword">var</span> c2_hi = g0_512_hi(W[i - <span class="number">30</span>], W[i - <span class="number">29</span>]);  <span class="comment">// i - 15</span>
    <span class="keyword">var</span> c2_lo = g0_512_lo(W[i - <span class="number">30</span>], W[i - <span class="number">29</span>]);
    <span class="keyword">var</span> c3_hi = W[i - <span class="number">32</span>];  <span class="comment">// i - 16</span>
    <span class="keyword">var</span> c3_lo = W[i - <span class="number">31</span>];

    W[i] = sum64_4_hi(
      c0_hi, c0_lo,
      c1_hi, c1_lo,
      c2_hi, c2_lo,
      c3_hi, c3_lo);
    W[i + <span class="number">1</span>] = sum64_4_lo(
      c0_hi, c0_lo,
      c1_hi, c1_lo,
      c2_hi, c2_lo,
      c3_hi, c3_lo);
  }
};

SHA512.prototype._update = <span class="function"><span class="keyword">function</span> <span class="title">_update</span><span class="params">(msg, start)</span> {</span>
  <span class="keyword">this</span>._prepareBlock(msg, start);

  <span class="keyword">var</span> W = <span class="keyword">this</span>.W;

  <span class="keyword">var</span> ah = <span class="keyword">this</span>.h[<span class="number">0</span>];
  <span class="keyword">var</span> al = <span class="keyword">this</span>.h[<span class="number">1</span>];
  <span class="keyword">var</span> bh = <span class="keyword">this</span>.h[<span class="number">2</span>];
  <span class="keyword">var</span> bl = <span class="keyword">this</span>.h[<span class="number">3</span>];
  <span class="keyword">var</span> ch = <span class="keyword">this</span>.h[<span class="number">4</span>];
  <span class="keyword">var</span> cl = <span class="keyword">this</span>.h[<span class="number">5</span>];
  <span class="keyword">var</span> dh = <span class="keyword">this</span>.h[<span class="number">6</span>];
  <span class="keyword">var</span> dl = <span class="keyword">this</span>.h[<span class="number">7</span>];
  <span class="keyword">var</span> eh = <span class="keyword">this</span>.h[<span class="number">8</span>];
  <span class="keyword">var</span> el = <span class="keyword">this</span>.h[<span class="number">9</span>];
  <span class="keyword">var</span> fh = <span class="keyword">this</span>.h[<span class="number">10</span>];
  <span class="keyword">var</span> fl = <span class="keyword">this</span>.h[<span class="number">11</span>];
  <span class="keyword">var</span> gh = <span class="keyword">this</span>.h[<span class="number">12</span>];
  <span class="keyword">var</span> gl = <span class="keyword">this</span>.h[<span class="number">13</span>];
  <span class="keyword">var</span> hh = <span class="keyword">this</span>.h[<span class="number">14</span>];
  <span class="keyword">var</span> hl = <span class="keyword">this</span>.h[<span class="number">15</span>];

  assert(<span class="keyword">this</span>.k.length === W.length);
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; W.length; i += <span class="number">2</span>) {
    <span class="keyword">var</span> c0_hi = hh;
    <span class="keyword">var</span> c0_lo = hl;
    <span class="keyword">var</span> c1_hi = s1_512_hi(eh, el);
    <span class="keyword">var</span> c1_lo = s1_512_lo(eh, el);
    <span class="keyword">var</span> c2_hi = ch64_hi(eh, el, fh, fl, gh, gl);
    <span class="keyword">var</span> c2_lo = ch64_lo(eh, el, fh, fl, gh, gl);
    <span class="keyword">var</span> c3_hi = <span class="keyword">this</span>.k[i];
    <span class="keyword">var</span> c3_lo = <span class="keyword">this</span>.k[i + <span class="number">1</span>];
    <span class="keyword">var</span> c4_hi = W[i];
    <span class="keyword">var</span> c4_lo = W[i + <span class="number">1</span>];

    <span class="keyword">var</span> T1_hi = sum64_5_hi(
      c0_hi, c0_lo,
      c1_hi, c1_lo,
      c2_hi, c2_lo,
      c3_hi, c3_lo,
      c4_hi, c4_lo);
    <span class="keyword">var</span> T1_lo = sum64_5_lo(
      c0_hi, c0_lo,
      c1_hi, c1_lo,
      c2_hi, c2_lo,
      c3_hi, c3_lo,
      c4_hi, c4_lo);

    c0_hi = s0_512_hi(ah, al);
    c0_lo = s0_512_lo(ah, al);
    c1_hi = maj64_hi(ah, al, bh, bl, ch, cl);
    c1_lo = maj64_lo(ah, al, bh, bl, ch, cl);

    <span class="keyword">var</span> T2_hi = sum64_hi(c0_hi, c0_lo, c1_hi, c1_lo);
    <span class="keyword">var</span> T2_lo = sum64_lo(c0_hi, c0_lo, c1_hi, c1_lo);

    hh = gh;
    hl = gl;

    gh = fh;
    gl = fl;

    fh = eh;
    fl = el;

    eh = sum64_hi(dh, dl, T1_hi, T1_lo);
    el = sum64_lo(dl, dl, T1_hi, T1_lo);

    dh = ch;
    dl = cl;

    ch = bh;
    cl = bl;

    bh = ah;
    bl = al;

    ah = sum64_hi(T1_hi, T1_lo, T2_hi, T2_lo);
    al = sum64_lo(T1_hi, T1_lo, T2_hi, T2_lo);
  }

  sum64(<span class="keyword">this</span>.h, <span class="number">0</span>, ah, al);
  sum64(<span class="keyword">this</span>.h, <span class="number">2</span>, bh, bl);
  sum64(<span class="keyword">this</span>.h, <span class="number">4</span>, ch, cl);
  sum64(<span class="keyword">this</span>.h, <span class="number">6</span>, dh, dl);
  sum64(<span class="keyword">this</span>.h, <span class="number">8</span>, eh, el);
  sum64(<span class="keyword">this</span>.h, <span class="number">10</span>, fh, fl);
  sum64(<span class="keyword">this</span>.h, <span class="number">12</span>, gh, gl);
  sum64(<span class="keyword">this</span>.h, <span class="number">14</span>, hh, hl);
};

SHA512.prototype._digest = <span class="function"><span class="keyword">function</span> <span class="title">digest</span><span class="params">(enc)</span> {</span>
  <span class="keyword">if</span> (enc === <span class="string">'hex'</span>)
    <span class="keyword">return</span> utils.toHex32(<span class="keyword">this</span>.h, <span class="string">'big'</span>);
  <span class="keyword">else</span>
    <span class="keyword">return</span> utils.split32(<span class="keyword">this</span>.h, <span class="string">'big'</span>);
};

<span class="function"><span class="keyword">function</span> <span class="title">ch64_hi</span><span class="params">(xh, xl, yh, yl, zh)</span> {</span>
  <span class="keyword">var</span> r = (xh &amp; yh) ^ ((~xh) &amp; zh);
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">ch64_lo</span><span class="params">(xh, xl, yh, yl, zh, zl)</span> {</span>
  <span class="keyword">var</span> r = (xl &amp; yl) ^ ((~xl) &amp; zl);
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">maj64_hi</span><span class="params">(xh, xl, yh, yl, zh)</span> {</span>
  <span class="keyword">var</span> r = (xh &amp; yh) ^ (xh &amp; zh) ^ (yh &amp; zh);
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">maj64_lo</span><span class="params">(xh, xl, yh, yl, zh, zl)</span> {</span>
  <span class="keyword">var</span> r = (xl &amp; yl) ^ (xl &amp; zl) ^ (yl &amp; zl);
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">s0_512_hi</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_hi = rotr64_hi(xh, xl, <span class="number">28</span>);
  <span class="keyword">var</span> c1_hi = rotr64_hi(xl, xh, <span class="number">2</span>);  <span class="comment">// 34</span>
  <span class="keyword">var</span> c2_hi = rotr64_hi(xl, xh, <span class="number">7</span>);  <span class="comment">// 39</span>

  <span class="keyword">var</span> r = c0_hi ^ c1_hi ^ c2_hi;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">s0_512_lo</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_lo = rotr64_lo(xh, xl, <span class="number">28</span>);
  <span class="keyword">var</span> c1_lo = rotr64_lo(xl, xh, <span class="number">2</span>);  <span class="comment">// 34</span>
  <span class="keyword">var</span> c2_lo = rotr64_lo(xl, xh, <span class="number">7</span>);  <span class="comment">// 39</span>

  <span class="keyword">var</span> r = c0_lo ^ c1_lo ^ c2_lo;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">s1_512_hi</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_hi = rotr64_hi(xh, xl, <span class="number">14</span>);
  <span class="keyword">var</span> c1_hi = rotr64_hi(xh, xl, <span class="number">18</span>);
  <span class="keyword">var</span> c2_hi = rotr64_hi(xl, xh, <span class="number">9</span>);  <span class="comment">// 41</span>

  <span class="keyword">var</span> r = c0_hi ^ c1_hi ^ c2_hi;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">s1_512_lo</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_lo = rotr64_lo(xh, xl, <span class="number">14</span>);
  <span class="keyword">var</span> c1_lo = rotr64_lo(xh, xl, <span class="number">18</span>);
  <span class="keyword">var</span> c2_lo = rotr64_lo(xl, xh, <span class="number">9</span>);  <span class="comment">// 41</span>

  <span class="keyword">var</span> r = c0_lo ^ c1_lo ^ c2_lo;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">g0_512_hi</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_hi = rotr64_hi(xh, xl, <span class="number">1</span>);
  <span class="keyword">var</span> c1_hi = rotr64_hi(xh, xl, <span class="number">8</span>);
  <span class="keyword">var</span> c2_hi = shr64_hi(xh, xl, <span class="number">7</span>);

  <span class="keyword">var</span> r = c0_hi ^ c1_hi ^ c2_hi;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">g0_512_lo</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_lo = rotr64_lo(xh, xl, <span class="number">1</span>);
  <span class="keyword">var</span> c1_lo = rotr64_lo(xh, xl, <span class="number">8</span>);
  <span class="keyword">var</span> c2_lo = shr64_lo(xh, xl, <span class="number">7</span>);

  <span class="keyword">var</span> r = c0_lo ^ c1_lo ^ c2_lo;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">g1_512_hi</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_hi = rotr64_hi(xh, xl, <span class="number">19</span>);
  <span class="keyword">var</span> c1_hi = rotr64_hi(xl, xh, <span class="number">29</span>);  <span class="comment">// 61</span>
  <span class="keyword">var</span> c2_hi = shr64_hi(xh, xl, <span class="number">6</span>);

  <span class="keyword">var</span> r = c0_hi ^ c1_hi ^ c2_hi;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}

<span class="function"><span class="keyword">function</span> <span class="title">g1_512_lo</span><span class="params">(xh, xl)</span> {</span>
  <span class="keyword">var</span> c0_lo = rotr64_lo(xh, xl, <span class="number">19</span>);
  <span class="keyword">var</span> c1_lo = rotr64_lo(xl, xh, <span class="number">29</span>);  <span class="comment">// 61</span>
  <span class="keyword">var</span> c2_lo = shr64_lo(xh, xl, <span class="number">6</span>);

  <span class="keyword">var</span> r = c0_lo ^ c1_lo ^ c2_lo;
  <span class="keyword">if</span> (r &lt; <span class="number">0</span>)
    r += <span class="number">0x100000000</span>;
  <span class="keyword">return</span> r;
}
</code></pre>