<h1>hmac.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">var</span> utils = require(<span class="string">'./utils'</span>);
<span class="keyword">var</span> assert = require(<span class="string">'minimalistic-assert'</span>);

<span class="function"><span class="keyword">function</span> <span class="title">Hmac</span><span class="params">(hash, key, enc)</span> {</span>
  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Hmac))
    <span class="keyword">return</span> <span class="keyword">new</span> Hmac(hash, key, enc);
  <span class="keyword">this</span>.Hash = hash;
  <span class="keyword">this</span>.blockSize = hash.blockSize / <span class="number">8</span>;
  <span class="keyword">this</span>.outSize = hash.outSize / <span class="number">8</span>;
  <span class="keyword">this</span>.inner = <span class="literal">null</span>;
  <span class="keyword">this</span>.outer = <span class="literal">null</span>;

  <span class="keyword">this</span>._init(utils.toArray(key, enc));
}
module.exports = Hmac;

Hmac.prototype._init = <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">(key)</span> {</span>
  <span class="comment">// Shorten key, if needed</span>
  <span class="keyword">if</span> (key.length > <span class="keyword">this</span>.blockSize)
    key = <span class="keyword">new</span> <span class="keyword">this</span>.Hash().update(key).digest();
  assert(key.length &lt;= <span class="keyword">this</span>.blockSize);

  <span class="comment">// Add padding to key</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> i = key.length; i &lt; <span class="keyword">this</span>.blockSize; i++)
    key.push(<span class="number">0</span>);

  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; key.length; i++)
    key[i] ^= <span class="number">0x36</span>;
  <span class="keyword">this</span>.inner = <span class="keyword">new</span> <span class="keyword">this</span>.Hash().update(key);

  <span class="comment">// 0x36 ^ 0x5c = 0x6a</span>
  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; key.length; i++)
    key[i] ^= <span class="number">0x6a</span>;
  <span class="keyword">this</span>.outer = <span class="keyword">new</span> <span class="keyword">this</span>.Hash().update(key);
};

Hmac.prototype.update = <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(msg, enc)</span> {</span>
  <span class="keyword">this</span>.inner.update(msg, enc);
  <span class="keyword">return</span> <span class="keyword">this</span>;
};

Hmac.prototype.digest = <span class="function"><span class="keyword">function</span> <span class="title">digest</span><span class="params">(enc)</span> {</span>
  <span class="keyword">this</span>.outer.update(<span class="keyword">this</span>.inner.digest());
  <span class="keyword">return</span> <span class="keyword">this</span>.outer.digest(enc);
};
</code></pre>