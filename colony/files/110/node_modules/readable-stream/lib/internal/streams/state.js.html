<h1>state.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">var</span> ERR_INVALID_OPT_VALUE = require(<span class="string">'../../../errors'</span>).codes.ERR_INVALID_OPT_VALUE;

<span class="function"><span class="keyword">function</span> <span class="title">highWaterMarkFrom</span><span class="params">(options, isDuplex, duplexKey)</span> {</span>
  <span class="keyword">return</span> options.highWaterMark != <span class="literal">null</span> ? options.highWaterMark : isDuplex ? options[duplexKey] : <span class="literal">null</span>;
}

<span class="function"><span class="keyword">function</span> <span class="title">getHighWaterMark</span><span class="params">(state, options, duplexKey, isDuplex)</span> {</span>
  <span class="keyword">var</span> hwm = highWaterMarkFrom(options, isDuplex, duplexKey);

  <span class="keyword">if</span> (hwm != <span class="literal">null</span>) {
    <span class="keyword">if</span> (!(isFinite(hwm) &amp;&amp; Math.floor(hwm) === hwm) || hwm &lt; <span class="number">0</span>) {
      <span class="keyword">var</span> name = isDuplex ? duplexKey : <span class="string">'highWaterMark'</span>;
      <span class="keyword">throw</span> <span class="keyword">new</span> ERR_INVALID_OPT_VALUE(name, hwm);
    }

    <span class="keyword">return</span> Math.floor(hwm);
  } <span class="comment">// Default value</span>


  <span class="keyword">return</span> state.objectMode ? <span class="number">16</span> : <span class="number">16</span> * <span class="number">1024</span>;
}

module.exports = {
  getHighWaterMark: getHighWaterMark
};</code></pre>