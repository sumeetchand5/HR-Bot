<h1>errors.js</h1>
<pre><code class="lang-js"><span class="string">'use strict'</span>;

<span class="keyword">const</span> codes = {};

<span class="function"><span class="keyword">function</span> <span class="title">createErrorType</span><span class="params">(code, message, Base)</span> {</span>
  <span class="keyword">if</span> (!Base) {
    Base = Error
  }

  <span class="function"><span class="keyword">function</span> <span class="title">getMessage</span> <span class="params">(arg1, arg2, arg3)</span> {</span>
    <span class="keyword">if</span> (<span class="keyword">typeof</span> message === <span class="string">'string'</span>) {
      <span class="keyword">return</span> message
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> message(arg1, arg2, arg3)
    }
  }

  class NodeError extends Base {
    constructor (arg1, arg2, arg3) {
      super(getMessage(arg1, arg2, arg3));
    }
  }

  NodeError.prototype.name = Base.name;
  NodeError.prototype.code = code;

  codes[code] = NodeError;
}

<span class="comment">// https://github.com/nodejs/node/blob/v10.8.0/lib/internal/errors.js</span>
<span class="function"><span class="keyword">function</span> <span class="title">oneOf</span><span class="params">(expected, thing)</span> {</span>
  <span class="keyword">if</span> (Array.isArray(expected)) {
    <span class="keyword">const</span> len = expected.length;
    expected = expected.map((i) => String(i));
    <span class="keyword">if</span> (len > <span class="number">2</span>) {
      <span class="keyword">return</span> `one of ${thing} ${expected.slice(<span class="number">0</span>, len - <span class="number">1</span>).join(<span class="string">', '</span>)}, or ` +
             expected[len - <span class="number">1</span>];
    } <span class="keyword">else</span> <span class="keyword">if</span> (len === <span class="number">2</span>) {
      <span class="keyword">return</span> `one of ${thing} ${expected[<span class="number">0</span>]} or ${expected[<span class="number">1</span>]}`;
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> `of ${thing} ${expected[<span class="number">0</span>]}`;
    }
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> `of ${thing} ${String(expected)}`;
  }
}

<span class="comment">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith</span>
<span class="function"><span class="keyword">function</span> <span class="title">startsWith</span><span class="params">(str, search, pos)</span> {</span>
	<span class="keyword">return</span> str.substr(!pos || pos &lt; <span class="number">0</span> ? <span class="number">0</span> : +pos, search.length) === search;
}

<span class="comment">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith</span>
<span class="function"><span class="keyword">function</span> <span class="title">endsWith</span><span class="params">(str, search, this_len)</span> {</span>
	<span class="keyword">if</span> (this_len === <span class="literal">undefined</span> || this_len > str.length) {
		this_len = str.length;
	}
	<span class="keyword">return</span> str.substring(this_len - search.length, this_len) === search;
}

<span class="comment">// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes</span>
<span class="function"><span class="keyword">function</span> <span class="title">includes</span><span class="params">(str, search, start)</span> {</span>
  <span class="keyword">if</span> (<span class="keyword">typeof</span> start !== <span class="string">'number'</span>) {
    start = <span class="number">0</span>;
  }

  <span class="keyword">if</span> (start + search.length > str.length) {
    <span class="keyword">return</span> <span class="literal">false</span>;
  } <span class="keyword">else</span> {
    <span class="keyword">return</span> str.indexOf(search, start) !== -<span class="number">1</span>;
  }
}

createErrorType(<span class="string">'ERR_INVALID_OPT_VALUE'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(name, value)</span> {</span>
  <span class="keyword">return</span> <span class="string">'The value "'</span> + value + <span class="string">'" is invalid for option "'</span> + name + <span class="string">'"'</span>
}, TypeError);
createErrorType(<span class="string">'ERR_INVALID_ARG_TYPE'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(name, expected, actual)</span> {</span>
  <span class="comment">// determiner: 'must be' or 'must not be'</span>
  <span class="keyword">let</span> determiner;
  <span class="keyword">if</span> (<span class="keyword">typeof</span> expected === <span class="string">'string'</span> &amp;&amp; startsWith(expected, <span class="string">'not '</span>)) {
    determiner = <span class="string">'must not be'</span>;
    expected = expected.replace(<span class="regexp">/^not /</span>, <span class="string">''</span>);
  } <span class="keyword">else</span> {
    determiner = <span class="string">'must be'</span>;
  }

  <span class="keyword">let</span> msg;
  <span class="keyword">if</span> (endsWith(name, <span class="string">' argument'</span>)) {
    <span class="comment">// For cases like 'first argument'</span>
    msg = `The ${name} ${determiner} ${oneOf(expected, <span class="string">'type'</span>)}`;
  } <span class="keyword">else</span> {
    <span class="keyword">const</span> type = includes(name, <span class="string">'.'</span>) ? <span class="string">'property'</span> : <span class="string">'argument'</span>;
    msg = `The <span class="string">"${name}"</span> ${type} ${determiner} ${oneOf(expected, <span class="string">'type'</span>)}`;
  }

  msg += `. Received type ${<span class="keyword">typeof</span> actual}`;
  <span class="keyword">return</span> msg;
}, TypeError);
createErrorType(<span class="string">'ERR_STREAM_PUSH_AFTER_EOF'</span>, <span class="string">'stream.push() after EOF'</span>);
createErrorType(<span class="string">'ERR_METHOD_NOT_IMPLEMENTED'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> {</span>
  <span class="keyword">return</span> <span class="string">'The '</span> + name + <span class="string">' method is not implemented'</span>
});
createErrorType(<span class="string">'ERR_STREAM_PREMATURE_CLOSE'</span>, <span class="string">'Premature close'</span>);
createErrorType(<span class="string">'ERR_STREAM_DESTROYED'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(name)</span> {</span>
  <span class="keyword">return</span> <span class="string">'Cannot call '</span> + name + <span class="string">' after a stream was destroyed'</span>;
});
createErrorType(<span class="string">'ERR_MULTIPLE_CALLBACK'</span>, <span class="string">'Callback called multiple times'</span>);
createErrorType(<span class="string">'ERR_STREAM_CANNOT_PIPE'</span>, <span class="string">'Cannot pipe, not readable'</span>);
createErrorType(<span class="string">'ERR_STREAM_WRITE_AFTER_END'</span>, <span class="string">'write after end'</span>);
createErrorType(<span class="string">'ERR_STREAM_NULL_VALUES'</span>, <span class="string">'May not write null values to stream'</span>, TypeError);
createErrorType(<span class="string">'ERR_UNKNOWN_ENCODING'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(arg)</span> {</span>
  <span class="keyword">return</span> <span class="string">'Unknown encoding: '</span> + arg
}, TypeError);
createErrorType(<span class="string">'ERR_STREAM_UNSHIFT_AFTER_END_EVENT'</span>, <span class="string">'stream.unshift() after end event'</span>);

module.exports.codes = codes;
</code></pre>