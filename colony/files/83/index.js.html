<h1>index.js</h1>
<pre><code class="lang-js"><span class="keyword">var</span> pathPlatform = require(<span class="string">'path-platform'</span>);

module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(cwd, opts)</span> {</span>
    <span class="keyword">if</span> (cwd === <span class="literal">undefined</span>) cwd = process.cwd();
    <span class="keyword">if</span> (!opts) opts = {};
    <span class="keyword">var</span> platform = opts.platform || process.platform;
    
    <span class="keyword">var</span> isWindows = <span class="regexp">/^win/</span>.test(platform);
    <span class="keyword">var</span> path = isWindows ? pathPlatform.win32 : pathPlatform;
    <span class="keyword">var</span> normalize = !isWindows ? path.normalize :
        path.normalize(<span class="string">'c:'</span>) === <span class="string">'c:.'</span> ? fixNormalize(path.normalize) :
        path.normalize;
    <span class="keyword">var</span> sep = isWindows ? <span class="regexp">/[\\\/]/</span> : <span class="string">'/'</span>;
    <span class="keyword">var</span> init = isWindows ? <span class="string">''</span> : <span class="string">'/'</span>;
    
    <span class="keyword">var</span> join = <span class="function"><span class="keyword">function</span> <span class="params">(x, y)</span> {</span>
        <span class="keyword">var</span> ps = [ x, y ].filter(<span class="function"><span class="keyword">function</span> <span class="params">(p)</span> {</span>
            <span class="keyword">return</span> p &amp;&amp; <span class="keyword">typeof</span> p === <span class="string">'string'</span>
        });

        <span class="keyword">return</span> normalize(ps.join(isWindows ? <span class="string">'\\'</span> : <span class="string">'/'</span>));
    };
    
    <span class="keyword">var</span> res = normalize(cwd)
        .split(sep)
        .reduce(<span class="function"><span class="keyword">function</span> <span class="params">(acc,dir,ix)</span> {</span>
            <span class="keyword">return</span> acc.concat(join(acc[ix], dir))
        }, [init])
        .slice(<span class="number">1</span>)
        .reverse()
    ;
    <span class="keyword">if</span> (res[<span class="number">0</span>] === res[<span class="number">1</span>]) <span class="keyword">return</span> [ res[<span class="number">0</span>] ];
    <span class="keyword">if</span> (isWindows &amp;&amp; <span class="regexp">/^\\/.test(cwd)) {
        return res.slice(0,-1).map(function (d) {
            var ch = d.charAt(0)
            return ch === '\\' ? d :
              ch === '.' ? '\\' + d.slice(1) :
              '\\' + d
        });
    }
    return res;

    function fixNormalize(fn) {
      return function(p) {
        return fn(p).replace(/</span>:\.$/, <span class="string">':'</span>)
      }
    }
}
</code></pre>